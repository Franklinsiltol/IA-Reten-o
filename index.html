<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroAssist - Assistente Inteligente (v3.6 - Perguntas Vagas)</title>
    <link rel="icon" type="image/png" href="https://lh3.googleusercontent.com/d/1-H-um4lnsC7fmbqtHNgX38eK8270SYOE">
    <!-- Dependências -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3"></script>
    <script src="https://unpkg.com/compromise@latest/builds/compromise.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Principal (sem alterações) */
        :root {
            --background-main: #FFFFFF; --background-secondary: #F0F2F5; --text-primary: #111B21;
            --text-secondary: #667781; --border-color: #E9EDEF; --primary: #007BFF;
            --accent: #00A884; --white: #FFFFFF; --black: #000000; --error: #d93025;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background-color: var(--background-secondary); color: var(--text-primary); line-height: 1.6; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 1rem; }
        .app-container { display: flex; flex-direction: column; max-width: 800px; width: 100%; height: 95vh; max-height: 900px; overflow: hidden; background-color: var(--background-main); border-radius: 24px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07); border: 1px solid var(--border-color); }
        header { background-color: var(--background-main); padding: 1rem 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .logo { display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon { width: 36px; height: 36px; border-radius: 50%; padding: 0; object-fit: cover; }
        .logo-text { font-weight: 600; font-size: 1.25rem; color: var(--text-primary); }
        /* NOVO: Container para os controles do cabeçalho */
        .header-controls { display: flex; align-items: center; gap: 0.75rem; }
        .status-indicator { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: var(--text-secondary); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background-color: var(--accent); }
        .status-dot.loading { background-color: #FF9800; animation: pulse 1.5s infinite; }
        .status-dot.error { background-color: var(--error); }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
        .chat-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; background-color: var(--background-main); }
        .chat-area { flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 0.75rem; }
        .chat-area::-webkit-scrollbar { width: 6px; }
        .chat-area::-webkit-scrollbar-track { background: transparent; }
        .chat-area::-webkit-scrollbar-thumb { background-color: #ccc; border-radius: 3px; }
        .message { max-width: 75%; padding: 0.75rem 1.25rem; border-radius: 20px; line-height: 1.5; position: relative; animation: fadeIn 0.4s ease-out; word-wrap: break-word; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .user-message { background-color: var(--primary); color: var(--white); margin-left: auto; border-bottom-right-radius: 5px; }
        .bot-message { background-color: var(--background-secondary); color: var(--text-primary); margin-right: auto; border-bottom-left-radius: 5px; }
        .message a { color: var(--primary); font-weight: 500; }
        .input-area-wrapper { background-color: var(--background-secondary); padding: 1rem 1.5rem; border-top: 1px solid var(--border-color); flex-shrink: 0; }
        .input-area { display: flex; align-items: center; gap: 0.75rem; }
        #questionInput { flex: 1; padding: 0.8rem 1.5rem; border-radius: 999px; border: 1px solid var(--border-color); background-color: var(--background-main); color: var(--text-primary); font-family: 'Inter', sans-serif; font-size: 1rem; outline: none; transition: border-color 0.2s, box-shadow 0.2s; }
        #questionInput:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15); }
        .button { border: none; border-radius: 50%; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; }
        #askButton { background-color: var(--primary); color: var(--white); width: 48px; height: 48px; flex-shrink: 0; }
        #suggestButton { background-color: transparent; color: var(--text-secondary); width: 48px; height: 48px; flex-shrink: 0; }
        /* NOVO: Estilo para o botão do dashboard no cabeçalho */
        .header-button {
            background: transparent; border: none; cursor: pointer; padding: 8px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: var(--text-secondary); transition: all 0.2s ease;
        }
        .header-button:hover { background-color: var(--background-secondary); color: var(--text-primary); }
        .header-button svg { width: 24px; height: 24px; }
        .settings-toggle { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; cursor: pointer; color: var(--text-secondary);}
        .toggle-switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 20px; }
        .toggle-slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .toggle-slider { background-color: var(--accent); }
        input:checked + .toggle-slider:before { transform: translateX(20px); }
        .custom-modal, #dashboardModal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.6);
            justify-content: center; align-items: center; padding: 1rem;
            animation: fadeInModal 0.3s ease;
        }
        @keyframes fadeInModal { from { opacity: 0; } to { opacity: 1; } }
        .custom-modal-content { background-color: var(--background-main); padding: 2rem; border-radius: 16px; width: 100%; max-width: 500px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: left; }
        /* NOVO: Estilo para o conteúdo do modal do dashboard */
        .dashboard-modal-content {
            background-color: var(--background-main); width: 90vw; height: 90vh; max-width: 1400px;
            border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden; position: relative;
            transform: scale(0.95); animation: zoomInModal 0.3s ease forwards;
        }
        @keyframes zoomInModal { from { transform: scale(0.95); } to { transform: scale(1); } }
        .dashboard-modal-content iframe { width: 100%; height: 100%; border: none; }
        #closeDashboardBtn {
            position: absolute; top: 12px; right: 12px; width: 36px; height: 36px;
            background-color: rgba(0,0,0,0.2); color: white;
            border: none; border-radius: 50%; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            z-index: 10; transition: all 0.2s ease;
        }
        #closeDashboardBtn:hover { background-color: rgba(0,0,0,0.4); transform: scale(1.1); }
        .notification-banner { background-color: #f8f9fa; border-left: 4px solid var(--primary); padding: 0.75rem 1rem; margin: 0.5rem 0; border-radius: 4px; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        /* Outros estilos permanecem os mesmos */
    </style>
</head>
<body>
    <div id="updateBanner" class="update-banner" style="display: none;">Nova atualização disponível! <a href="#" id="refreshLink">Recarregar agora</a></div>

    <div class="app-container">
        <header>
            <div class="logo">
                <img src="https://lh3.googleusercontent.com/d/1tG7oc1T5Xd3f1vZ267xPCX9k2SVrfNz1" alt="Logo" class="logo-icon">
                <div class="logo-text">NeuroAssist</div>
            </div>
            <!-- Container para os controles -->
            <div class="header-controls">
                <!-- NOVO: Botão do Dashboard -->
                <button id="dashboardButton" class="header-button" title="Abrir Dashboard de Links">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3,3h8v8H3V3z M13,3h8v8h-8V3z M3,13h8v8H3V13z M13,13h8v8h-8V13z"/></svg>
                </button>
                <div class="settings-toggle">
                    <label class="toggle-switch"><input type="checkbox" id="advancedModeToggle"><span class="toggle-slider"></span></label>
                    <span>Avançado</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot loading"></div>
                    <span id="statusText">Conectando...</span>
                </div>
            </div>
        </header>
        <div class="chat-container">
            <div class="chat-area" id="chatArea"></div>
            <div class="input-area-wrapper">
                 <!-- ... (resto da área de input sem alterações) ... -->
                <div class="input-area">
                    <input type="text" id="questionInput" placeholder="Digite sua mensagem..." autocomplete="off">
                    <button id="suggestButton" class="button" title="Sugerir uma pergunta"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 16V12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                    <button id="askButton" class="button" title="Enviar"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                </div>
                 <div id="autoUpdateStatus" class="status-footer"></div>
            </div>
        </div>
    </div>
    
    <!-- Modal de Sugestão (existente) -->
    <div id="customSuggestionModal" class="custom-modal"><div class="custom-modal-content"><h3>Sugerir uma pergunta</h3><p>Não encontrou o que procurava? Ajude-nos a melhorar! Envie sua pergunta e ela será analisada por nossa equipe para ser adicionada à base de conhecimento.</p><textarea id="suggestionTextarea" placeholder="Escreva aqui a pergunta que você não encontrou..."></textarea><div class="modal-actions"><button id="cancelSuggestionBtn" class="action-button no">Cancelar</button><button id="submitSuggestionBtn" class="action-button yes">Enviar sugestão</button></div></div></div>

    <!-- NOVO: Modal do Dashboard -->
    <div id="dashboardModal">
        <div class="dashboard-modal-content">
            <button id="closeDashboardBtn" title="Fechar">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
            <iframe src="https://franklinsiltol.github.io/dashdelink/" title="Dashboard de Links"></iframe>
        </div>
    </div>

    <script>
        class NeuroAssist {
            constructor() {
                this.config = {
                    // ... (configurações sem alterações) ...
                };
                this.elements = { 
                    questionInput: document.getElementById('questionInput'), 
                    askButton: document.getElementById('askButton'), 
                    suggestButton: document.getElementById('suggestButton'), 
                    chatArea: document.getElementById('chatArea'), 
                    statusText: document.getElementById('statusText'), 
                    statusDot: document.querySelector('.status-dot'), 
                    // ... (outros elementos) ...
                    customSuggestionModal: document.getElementById('customSuggestionModal'), 
                    suggestionTextarea: document.getElementById('suggestionTextarea'), 
                    submitSuggestionBtn: document.getElementById('submitSuggestionBtn'), 
                    cancelSuggestionBtn: document.getElementById('cancelSuggestionBtn'),
                    // NOVO: Elementos do dashboard
                    dashboardButton: document.getElementById('dashboardButton'),
                    dashboardModal: document.getElementById('dashboardModal'),
                    closeDashboardBtn: document.getElementById('closeDashboardBtn')
                };
                this.state = { 
                    // ... (estado sem alterações) ...
                };
                this._init();
            }
            
            async _init() {
                try {
                    await this._initDatabase(); 
                    await this._loadInitialData(); 
                    this._setupEventListeners(); // A lógica do novo botão será adicionada aqui
                    this._checkAndDisplayPersistentNotification();
                    this._startAutoUpdate(); 
                    this._startNotificationCheck(); 
                    await this._checkAdvancedModeStatus();
                } catch (error) { 
                    console.error("Falha na inicialização crítica:", error); 
                    this._updateStatus("Erro crítico", 'error'); 
                }
            }
            
            // ... (A maioria dos métodos da classe NeuroAssist permanece igual) ...

            _setupEventListeners(){
                this.elements.askButton.addEventListener('click',()=>this._handleQuestion());
                this.elements.questionInput.addEventListener('keypress',(e)=>{if(e.key==='Enter')this._handleQuestion();});
                
                // ... (outros event listeners existentes) ...
                this.elements.suggestButton.addEventListener('click',()=>{this.elements.customSuggestionModal.style.display='flex';});
                this.elements.cancelSuggestionBtn.addEventListener('click',()=>{this.elements.customSuggestionModal.style.display='none';});
                this.elements.customSuggestionModal.addEventListener('click',(e)=>{if(e.target===this.elements.customSuggestionModal){this.elements.customSuggestionModal.style.display='none';}});
                this.elements.submitSuggestionBtn.addEventListener('click',()=>{const question=this.elements.suggestionTextarea.value.trim();if(question){this._submitQuestionToForm(question,true);this.elements.suggestionTextarea.value='';this.elements.submitSuggestionBtn.textContent='Enviado!';setTimeout(()=>{this.elements.customSuggestionModal.style.display='none';this.elements.submitSuggestionBtn.textContent='Enviar sugestão';},2000);}});
                
                // NOVO: Listeners para o modal do dashboard
                this.elements.dashboardButton.addEventListener('click', () => {
                    this.elements.dashboardModal.style.display = 'flex';
                });

                this.elements.closeDashboardBtn.addEventListener('click', () => {
                    this.elements.dashboardModal.style.display = 'none';
                });
                
                // Fecha o modal clicando no fundo escuro
                this.elements.dashboardModal.addEventListener('click', (e) => {
                    if (e.target === this.elements.dashboardModal) {
                        this.elements.dashboardModal.style.display = 'none';
                    }
                });

                this.elements.refreshLink.onclick=(e)=>{e.preventDefault();this.elements.updateBanner.style.display='none';this._fetchAndUpdateData(true);};
            }
            
            // ... (Restante do código da classe NeuroAssist sem alterações) ...
            _checkAndDisplayPersistentNotification() {
                const storedText = localStorage.getItem('neuroAssistNotificationText');
                const storedTimestamp = localStorage.getItem('neuroAssistNotificationTimestamp');
                const twentyFourHours = 24 * 60 * 60 * 1000;

                if (storedText && storedTimestamp) {
                    const age = Date.now() - parseInt(storedTimestamp, 10);
                    if (age < twentyFourHours) {
                        this._showNotification(storedText);
                        this.state.lastNotification = storedText;
                    } else {
                        localStorage.removeItem('neuroAssistNotificationText');
                        localStorage.removeItem('neuroAssistNotificationTimestamp');
                    }
                }
            }
            async _checkForNotifications() {
                try {
                    const url = `https://docs.google.com/spreadsheets/d/${this.config.SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${encodeURIComponent(this.config.NOTIFICATION_SHEET)}&range=A1&t=${Date.now()}`;
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
                    
                    const csvText = await response.text();
                    const notificationText = this._parseCSV(csvText)[0][0]?.trim();
                    
                    if (notificationText && notificationText !== this.state.lastNotification) {
                        localStorage.setItem('neuroAssistNotificationText', notificationText);
                        localStorage.setItem('neuroAssistNotificationTimestamp', Date.now().toString());

                        this._showNotification(notificationText);
                        this.state.lastNotification = notificationText;
                    }
                } catch (error) {
                    console.error("Erro ao verificar notificações:", error);
                }
            }
            _showNotification(text) {
                if (!text) return;
                const existingBanner = document.getElementById('active-notification-banner');
                if (existingBanner) existingBanner.remove();
                
                const notificationDiv = document.createElement('div');
                notificationDiv.id = 'active-notification-banner';
                notificationDiv.className = 'notification-banner';
                notificationDiv.innerHTML = `<strong>Notificação:</strong> ${text}`;
                
                if (this.elements.chatArea.firstChild) {
                    this.elements.chatArea.insertBefore(notificationDiv, this.elements.chatArea.firstChild);
                } else {
                    this.elements.chatArea.appendChild(notificationDiv);
                }
                this.elements.chatArea.scrollTop = 0;
            }
        }
        document.addEventListener('DOMContentLoaded', () => { window.neuroAssist = new NeuroAssist(); });
    </script>
    
    <!-- O código do botão flutuante foi REMOVIDO daqui -->

</body>
</html>
